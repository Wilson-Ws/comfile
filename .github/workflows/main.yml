name: Fetch and Save Text from kelee.one

on:
  #schedule:
    # 每小时运行一次
    #- cron: '0 * * * *'
  workflow_dispatch:  # 允许手动触发

jobs:
  fetch_and_save:
    runs-on: ubuntu-latest

    steps:
    # 1. 检出代码
    - name: Checkout repository
      uses: actions/checkout@v2

    # 2. 设置 Python 环境
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.9'

    # 3. 安装所需的库
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests

    # 4. 获取文本内容并保存到动态生成的文件中
    - name: Fetch text from kelee.one and save
      run: |
        python fetch_text.py  # 运行你编写的 Python 脚本

    # 5. 提交并推送更新（动态提交生成的文件）
    - name: Commit and push changes
      run: |
        # 设置 git 用户信息
        git config --global user.name 'github-actions'
        git config --global user.email 'github-actions@github.com'
        
        # 遍历生成的文件并提交
        for file in $(find . -type f -name "*.txt"); do
          git add "$file"
          git commit -m "Update text content from kelee.one - $file"
        done
        
        # 推送到 GitHub
        git push
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
